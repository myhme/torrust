#include <tunables/global>

profile docker-tor-hardened-rust flags=(attach_disconnected,mediate_deleted) {

  # --- Base abstractions ---
  # These REQUIRE <tunables/global> above
  #include <abstractions/base>
  #include <abstractions/nameservice>

  # --- Executable ---
  /torrust rmix,

  # --- TLS trust roots ---
  /etc/ssl/certs/** r,
  /usr/share/ca-certificates/** r,

  # --- Networking ---
  network inet tcp,
  network inet udp,
  deny network raw,

  # --- Capabilities ---
  capability ipc_lock,

  # --- Tor state (tmpfs, pre-created) ---
  /var/lib/tor/ rw,
  /var/lib/tor/** rwk,

  # --- Temporary files ---
  /tmp/** rwk,

  # --- Final deny ---
  deny /** w,
}
