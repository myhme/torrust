#include <tunables/global>

profile docker-tor-hardened-rust flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  #include <abstractions/nameservice>

  # === THE BINARY ===
  /torrust rmix,

  # === READ-ONLY SYSTEM FILES ===
  /etc/ssl/certs/** r,
  /etc/pki/tls/certs/** r,
  /usr/share/ca-certificates/** r,
  
  @{PROC}/sys/kernel/random/uuid r,
  @{PROC}/sys/kernel/osrelease r,
  @{PROC}/meminfo r,

  # === NETWORK ===
  network inet tcp,
  network inet udp,
  deny network raw,

  # === CAPABILITIES ===
  capability ipc_lock,

  # === ALLOW WRITING TO RAM DISK (CRITICAL FIX) ===
  # This allows Arti to write its state/cache to the tmpfs mount.
  # We must add this BEFORE the "deny all" rule.
  /var/lib/tor/** rw,
  /var/lib/tor/ rw,

  # === DENY EVERYTHING ELSE ===
  deny /** w,
}