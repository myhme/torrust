#include <tunables/global>

profile docker-tor-hardened-rust flags=(attach_disconnected,mediate_deleted) {

  abi <abi/4.0>,

  # Base abstractions
  include <abstractions/base>
  include <abstractions/nameservice>
  include <abstractions/ssl_certs>
  include <abstractions/user-tmp>

  # Binary
  /torrust ix,

  # Root filesystem (read-only)
  / r,
  /** r,

  # Tor state (tmpfs)
  /var/lib/tor/state/ rw,
  /var/lib/tor/state/** rwk,

  # /tmp (tmpfs)
  /tmp/ rw,
  /tmp/** rw,

  # proc (minimal)
  /proc/ r,
  /proc/self/** r,

  # sysfs (read-only)
  /sys/ r,
  /sys/** r,

  # Dangerous proc interfaces
  deny /proc/*/mem rwklx,
  deny /proc/kcore rwklx,
  deny /proc/sysrq-trigger rwklx,
}
