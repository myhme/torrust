services:
  torrust:
    build: .
    image: torrust:latest
    container_name: torrust
    restart: "no"
    user: "10001"
    read_only: true
    cap_drop: [ALL]
    cap_add: [IPC_LOCK]
    security_opt:
      - no-new-privileges:true
      - apparmor=docker-tor-hardened-rust
    ports:
      - "9150:9150"
      - "5353:5353"
    environment:
      - RUST_LOG=info
      - TORGO_ENABLE_CHAFF=1
      - COMMON_SOCKS_PROXY_PORT=9150
      - COMMON_DNS_PROXY_PORT=5353
    volumes:
      - type: tmpfs
        target: /var/lib/tor
        tmpfs:
          size: 64m
          mode: 0777   # <--- THIS IS THE KEY. 0777 makes it writable.
      - type: tmpfs
        target: /tmp
        tmpfs:
          size: 16m
          mode: 1777
